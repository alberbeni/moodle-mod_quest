<?php
    require_once("$CFG->dirroot/mod/quest/lib.php");  // for parameter arrays
    require_once("$CFG->dirroot/mod/quest/locallib.php");  // for parameter arrays

    // ...and fill the form if needed
    if (empty($form->name)) {
        $form->name = "";
    }
    if (empty($form->description)) {
        $form->description = "";
    }
    if (!isset($form->nattachments)) {
        $form->nattachments = 0;
    }
    if (empty($form->validateassessment)) {
        $form->validateassessment = 0;
	}	
    if (empty($form->usepassword)) {
        $form->usepassword = 0;
    }
    if (empty($form->maxbytes)) {
        $form->maxbytes = "";
    }
    if (empty($form->datestart)) {
        $form->datestart = time();
    }
    if (empty($form->dateend)) {
        $form->dateend = time()+7*24*3600;
    }
    if (!isset($form->gradingstrategy)) {
       $form->gradingstrategy = 1;  // default is accumulative
    }
    if (!isset($form->nelements)) {
        $form->nelements = 1;
    }
    if (!isset($form->timemaxquestion)) {
        $form->timemaxquestion = 14;
    }
    if (!isset($form->nmaxanswers)) {
        $form->nmaxanswers = 25;
    }
    if (!isset($form->maxcalification)) {
        $form->maxcalification = 100;
    }
    if (!isset($form->initialpoints)) {
        $form->initialpoints = 100;
    }
    if (!isset($form->tinitial)) {
        $form->tinitial = 3;
    }
    if (!isset($form->gradingstrategyautor)) {
       $form->gradingstrategyautor = 1;  // default is accumulative
    }
    if (!isset($form->nelementsautor)) {
        $form->nelementsautor = 1;
    }
    if (!isset($form->typegrade)) {
       $form->typegrade = 0;  // default is individual
    }
    if (!isset($form->typecalification)) {
       $form->typecalification = 0;  // default is linear
    }
    if (empty($form->allowteams)) {
        $form->allowteams = 0;
    }
    if (!isset($form->ncomponents)) {
        $form->ncomponents = 2;
    }
    if (empty($form->format)) {
        $form->format = "";
    }
    if (empty($form->teamporcent)) {
        $form->teamporcent = 25;
    }
    if (!isset($form->showclasifindividual)) {
        $form->showclasifindividual = 1;
    }
	 if (!isset($form->showauthoringdetails)) {
        $form->showauthoringdetails = 0;
    }
    if (!isset($form->permitviewautors)) {
        $form->permitviewautors = 0;
    }

?>

<form name="form" method="post" action="mod.php">
<table cellpadding="5">
 <tr valign="center">
    <td height="29" colspan="2" valign="top"><div align="center"><b>Características aa Generales</b></div></td>
</tr>
<tr valign="top">
    <td  align="right"><b><?php  print_string("title", "quest") ?>
      :</b></td>
    <td width="358">
        <input type="text" name="name" size="60" value="<?php  p($form->name) ?>" alt="<?php  print_string("title", "quest") ?>" />
    </td>
</tr>
<tr valign="top">
    <td align="right"><b><?php  print_string("description", "quest") ?>:</b><br />
    <font size="1">
     <?php
        helpbutton("writing", get_string("helpwriting"), "moodle", true, true);
        echo "<br />";
        if ($usehtmleditor) {
           helpbutton("richtext", get_string("helprichtext"), "moodle", true, true);
        } else {
           helpbutton("text", get_string("helptext"), "moodle", true, true);
           echo "<br />";
           emoticonhelpbutton("form", "description", "moodle", true, true);
           echo "<br />";
        }
      ?>
      <br />
    </font>
    </td>
    <td>
    <?php
       print_textarea($usehtmleditor, 20, 60, 595, 400, "description", $form->description);

       if ($usehtmleditor) {
           echo '<input type="hidden" name="format" value="'.FORMAT_HTML.'" />';
       } else {
           echo '<p align="right">';
           helpbutton("textformat", get_string("formattexttype"));
           print_string("formattexttype");
           echo ':&nbsp;';
           if (!$form->format) {
               $form->format = $defaultformat;
           }
           echo html_writer::select(format_text_menu(), "format", $form->format, "");
           echo '</p>';
       }
    ?>
    </td>
</tr>
<tr valign="top">
    <td align="right"><b><?php  print_string("numberofattachments", "quest") ?>:</b></td>
    <td align="left">
        <?php

        for ($i=5; $i>=0; $i--) {
            $numbers[$i] = $i;
        }
        echo html_writer::select($numbers, "nattachments", "$form->nattachments", "");
       helpbutton("nattachments", get_string("numberofattachments", "quest"), "quest");
        ?>
    </td>
</tr>

<tr>
    <td align="right"><b><?php  print_string("validateassessment", "quest") ?>:</b></td>
    <td align="left">
    <?php
        $options[0] = get_string("no"); $options[1] = get_string("yes");
        echo html_writer::select($options, "validateassessment", $form->validateassessment, "");
        helpbutton("validateassessment", get_string("validateassessment", "quest"), "quest");
    ?>
    </td>
</tr>
<tr>
    <td align="right"><b><?php  print_string("usepassword", "quest"); ?>:</b></td>
    <td align="left">
    <?php
        $options[0] = get_string("no"); $options[1] = get_string("yes");
        echo html_writer::select($options, "usepassword", $form->usepassword, "");
        helpbutton("usepassword", get_string("usepassword", "quest"), "quest");
    ?>
    </td>
</tr>

<tr>
    <td align="right"><b><?php  print_string("password"); ?>:</b></td>
    <td align="left">
        <input type="text" name="password" size="10" value="" alt="<?php  print_string("password"); ?>" /> <?php echo " (".get_string("leavetokeep").")"; ?>
        <?php helpbutton("password", get_string("password"), "quest"); ?>
    </td>
</tr>
<tr valign="top">
    <td align="right"><b><?php  print_string("maximumsize", "quest") ?>:</b></td>
    <td align="left">

        <?php
        $sizelist = array("10Kb", "50Kb", "100Kb", "500Kb", "1Mb", "2Mb", "5Mb", "10Mb", "20Mb", "50Mb");
        $maxsize = get_max_upload_file_size();
        $sizeinlist = false;
        foreach ($sizelist as $size) {
            $sizebytes = get_real_size($size);
            if ($sizebytes < $maxsize) {
                $filesize[$sizebytes] = $size;
            }
            if ($form->maxbytes == $sizebytes) {
                $sizeinlist = true;
            }
        }
        $filesize[$maxsize] = display_size($maxsize);
        if (!$sizeinlist) {
            $form->maxbytes = get_real_size("500K");
        }
        ksort($filesize, SORT_NUMERIC);
        echo html_writer::select($filesize, "maxbytes", "$form->maxbytes", "");
        ?>
    </td>
</tr>
<tr valign="top">
    <td align="right"><b><?php  print_string("dateofstart", "quest") ?>:</b></td>
    <td align="left">
<?php
            print_date_selector("datestartday", "datestartmonth", "datestartyear", $form->datestart);
            echo "&nbsp;-&nbsp;";
            print_time_selector("datestarthour", "datestartminute", $form->datestart);
            helpbutton("datestart", get_string("dateofstart", "quest"), "quest");
    ?></td>
</tr>
<tr valign="top">
    <td align="right"><b><?php  print_string("dateofend", "quest") ?>:</b></td>
    <td align="left">
<?php
            print_date_selector("dateendday", "dateendmonth", "dateendyear", $form->dateend);
            echo "&nbsp;-&nbsp;";
            print_time_selector("dateendhour", "dateendminute", $form->dateend);
            helpbutton("dateend", get_string("dateofend", "quest"), "quest");
    ?></td>
</tr>

<tr>
    <td align="right"><b><?php  print_string("allowteams", "quest") ?>:</b></td>
    <td align="left">
    <?php
        $options[0] = get_string("no"); $options[1] = get_string("yes");
        echo html_writer::select($options, "allowteams", $form->allowteams, "");
        helpbutton("allowteams", get_string("allowteams", "quest"), "quest");
    ?>
    </td>
</tr>
<tr valign="top">
    <td align="right"><b><?php  print_string("numbercomponents", "quest") ?>:</b></td>
    <td align="left">
     <?php
        unset($numbers);
        for ($i=20; $i>=2; $i--) {
            $numbers[$i] = $i;
        }
        echo html_writer::select($numbers, "ncomponents", "$form->ncomponents", "");
        helpbutton("ncomponents", get_string("numbercomponents", "quest"), "quest");
        ?>
    </td>
</tr>
<tr>
    <td align="right"><b><?php  print_string("showclasifindividual", "quest"); ?>:</b></td>
    <td align="left">
    <?php
        $options[0] = get_string("no"); $options[1] = get_string("yes");
        echo html_writer::select($options, "showclasifindividual", $form->showclasifindividual, "");
        helpbutton("showclasifindividual", get_string("showclasifindividual", "quest"), "quest");
    ?>
    </td>
</tr>
<tr>
    <td align="right"><b><?php  print_string("showauthoringdetails", "quest"); ?>:</b></td>
    <td align="left">
    <?php
        $options[0] = get_string("no"); $options[1] = get_string("yes");
        echo html_writer::select($options, "showauthoringdetails", $form->showauthoringdetails, "");
        helpbutton("showauthoringdetails", get_string("showauthoringdetails", "quest"), "quest");
    ?>
    </td>
</tr>

<tr>
    <td align="right"><b><?php  print_string("permitviewautors", "quest"); ?>:</b></td>
    <td align="left">
    <?php
        $options[0] = get_string("no"); $options[1] = get_string("yes");
        echo html_writer::select($options, "permitviewautors", $form->permitviewautors, "");
        helpbutton("permitviewautors", get_string("permitviewautors", "quest"), "quest");
    ?>
    </td>
</tr>
 <tr valign="center">
    <td height="29" colspan="2" valign="top"><div align="center"><b>Características de Evaluación</b></div></td>
</tr>
<!-- Only Grading strategy is Accumulative ==> 1
<input type="hidden" name="gradingstrategy" value="1" />
<tr valign="top">
    <td align="right"><b><?php  print_string("gradingstrategy", "quest") ?>:</b></td>
    <td>
    <?php
       echo html_writer::select($QUEST_TYPE, "gradingstrategy", $form->gradingstrategy, "");
       helpbutton("gradingstrategy", get_string("gradingstrategy", "quest"), "quest");
    ?>
    </td>
</tr>
-->
<tr valign="top">
    <td align="right"><b><?php  print_string("numberofassessmentelements", "quest") ?>:</b></td>
    <td align="left">
        <?php
        unset($numbers);
        for ($i=20; $i>=0; $i--) {
            $numbers[$i] = $i;
        }
        echo html_writer::select($numbers, "nelements", "$form->nelements", "");
       helpbutton("nelements", get_string("numberofassessmentelements", "quest"), "quest");
        ?>
    </td>
</tr>
<input type="hidden" name="gradingstrategyautor" value="1" />
<!--Only strategy in accumulative ==>1
<tr valign="top">
    <td align="right"><b><?php  print_string("gradingstrategyautor", "quest") ?>:</b></td>
    <td align="left">
    <?php
       echo html_writer::select($QUEST_TYPE, "gradingstrategyautor", $form->gradingstrategyautor, "");
       helpbutton("gradingstrategyautor", get_string("gradingstrategyautor", "quest"), "quest");
    ?>
    </td>
</tr>
-->
<tr valign="top">
    <td align="right"><b><?php  print_string("numberofassessmentelementsautor", "quest") ?>:</b></td>
    <td align="left">
        <?php
        unset($numbers);
        for ($i=20; $i>=0; $i--) {
            $numbers[$i] = $i;
        }
        echo html_writer::select($numbers, "nelementsautor", "$form->nelementsautor", "");
       helpbutton("nelementsautor", get_string("numberofassessmentelementsautor", "quest"), "quest");
        ?>
    </td>
</tr>
<tr valign="center">
    <td height="29" colspan="2" valign="top"><div align="center"><b>Características de Calificación</b></div></td>
</tr>

<tr valign="top">
    <td align="right"><b><?php  print_string("typegrade", "quest") ?>:</b></td>
    <td align="left">
    <?php
       echo html_writer::select($QUEST_TYPE_GRADES, "typegrade", $form->typegrade, "");
       helpbutton("typegrade", get_string("typegrade", "quest"), "quest");
    ?>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php  print_string("timemaxoflife", "quest") ?>:</b></td>
    <td align="left">
        <?php
        unset($numbers);
        for ($i=31; $i>=0; $i--) {
            $numbers[$i] = $i;
        }
        echo html_writer::select($numbers, "timemaxquestion", "$form->timemaxquestion", "");
       helpbutton("timemaxquestion", get_string("timemaxoflife", "quest"), "quest");
        ?>
    </td>
</tr>
<tr valign="top">
    <td align="right"><b><?php  print_string("numbermaxofanswers", "quest") ?>:</b></td>
    <td align="left">
        <?php
        for ($i=300; $i>=1; $i--) {
            $grades[$i] = $i;
        }
        echo html_writer::select($grades, "nmaxanswers", "$form->nmaxanswers", "");
        helpbutton("nmaxanswers", get_string("numbermaxofanswers", "quest"), "quest");
        ?>
    </td>
</tr>


<tr valign="top">
    <td align="right"><b><?php  print_string("typecalification", "quest") ?>:</b></td>
    <td align="left">
    <?php
       echo html_writer::select($QUEST_TYPE_POINTS, "typecalification", $form->typecalification, "");
       helpbutton("typecalification", get_string("typecalification", "quest"), "quest");
    ?>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php  print_string("maxcalification", "quest") ?>:</b></td>
    <td align="left">
        <?php

        echo html_writer::select($grades, "maxcalification", "$form->maxcalification", "");
        helpbutton("maxcalification", get_string("maxcalification", "quest"), "quest");
        ?>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php  print_string("initialpoints", "quest") ?>:</b></td>
    <td align="left">
        <?php

        echo html_writer::select($grades, "initialpoints", "$form->initialpoints", "");
        helpbutton("initialpoints", get_string("initialpoints", "quest"), "quest");
        ?>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php  print_string("tinitial", "quest") ?>:</b></td>
    <td align="left">
        <?php
        unset($numbers);
        for ($i=31; $i>=0; $i--) {
            $numbers[$i] = $i;
        }
        echo html_writer::select($numbers, "tinitial", "$form->tinitial", "");
       helpbutton("tinitial", get_string("tinitial", "quest"), "quest");
        ?>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php  print_string("teamporcent", "quest") ?>:</b></td>
    <td align="left">
        <?php
        unset($numbers);
        for ($i=100; $i>=0; $i--) {
            $numbers[$i] = $i;
        }
        echo html_writer::select($numbers, "teamporcent", "$form->teamporcent", "");
        helpbutton("teamporcent", get_string("teamporcent", "quest"), "quest");
        ?>
    </td>
</tr>



<?php print_standard_coursemodule_settings($form); ?>
</table>
<br />
<center>
<input type="hidden" name="course"     value="<?php  p($form->course) ?>" />
<input type="hidden" name="sesskey"    value="<?php  p($form->sesskey) ?>" />
<input type="hidden" name="coursemodule"  value="<?php  p($form->coursemodule) ?>" />
<input type="hidden" name="section"    value="<?php  p($form->section) ?>" />
<input type="hidden" name="module"     value="<?php  p($form->module) ?>" />
<input type="hidden" name="modulename" value="<?php  p($form->modulename) ?>" />
<input type="hidden" name="instance"   value="<?php  p($form->instance) ?>" />
<input type="hidden" name="mode"       value="<?php  p($form->mode) ?>" />
<input type="submit" value="<?php  print_string("savechanges") ?>" />
<input type="submit" name="cancel" value="<?php  print_string("cancel") ?>" />


</center>
</form>
